# Main函数

从一个main函数分析一个程序

# main函数是怎么启动的

函数包含了函数头，函数定义。函数头描述了函数与调用它的函数之间的接口，例如函数名、返回值和参数。

通常Main函数是被启动代码调用的，在"重拾C++"笔记中有提到，编译器会在目标代码中插入启动代码。所有Main函数其实是操作系统执行程序的入口，Main函数的函数头是描述程序和操作系统之间的接口。

# main函数的隐藏返回值

~~~c++
int main()
~~~

上方的函数头为ANSI/ISO C++ 标准写法（在"重拾C++"笔记中有提到C++后来建立了一套标准以保证程序的可移植性）。

要求必须返回一个int值。大多数程序员认为写下：

~~~c++
reture 0
~~~

是很累的一件事。正如Java类必须要有默认构造函数一样 。所以 'return 0' 可以默认省略，但是只对main函数有效。

# 什么情况不需要main函数

+ 非独立程序:  DLL动态链接库
+ 一些专用环境程序

常规程序都需要main函数，当然一些开发框架在开发时不需要写main，那是因为框架提供一些非标准的程序入口函数，这些函数还是会被框架定义的main函数调用，例如Android Activity中的onCreate函数。

# 预处理器

一个简单的c++ 程序：

~~~c++

# include <iostream>

int main(){
    using namespace std;
    cout << "Hello BA!!!" << endl;
    cout << "welcome to c++" << endl ;
}
~~~

该程序包含了："# include <iostream>"。这行代码存在的意义就是简化程序，是c++98的标准。

当编译器对程序进行编译前会使用预处理器在对主程序编译前进行一个预处理操作：执行 **#** 开头的编译指令。

执行后的结果：将iostream文件的内容添加到程序 **#** 开头的编译指令的位置，生成一个源代码与iostream代码组合的临时文件，后续将使用这个临时文件进行接下来的编译。

该文件实现了程序与外部世界之间的通信：cout和cin等。

# 头文件

像iostream这样的文件叫做包含文件---上文说到他们是被包含到其他程序中，同时由于放在了其他程序文件的起始部分，所以也叫头文件。复杂的是头文件有很多扩展名，你可以根据头文件的扩展名区分出该头文件的类型：

| 头文件类型     | 扩展名                | 示例       | 说明                                                         |
| -------------- | --------------------- | ---------- | ------------------------------------------------------------ |
| c++            | 以 .h 结尾            | iostream.h | 只有c++可以使用，和下面的一项区分不出来，真是操蛋            |
| c的旧风格      | 以 .h 结尾            | math.h     | c++，c都能用                                                 |
| c++新风格      | 没有扩展名            | iostream   | c++可以使用，但是要加上命名空间，可能大家也知道上面两种很难区分，所以搞个新的风格吧 |
| 通过C转换成C++ | 加上c前缀，没有扩展名 | cmath      | c++程序可以使用不是C的特性。                                 |

花里胡哨的扩展名，难怪要标准。委员会也是牛皮，直接砍掉扩展名。

# 名称空间

当使用iostream而不是iostream.h时，就需要使用下面的名称空间编译指令"using namespace std"来使iostream中定义对程序可用，例如：cout，cin。

"using namaspase xxx"是c++的特性，主要是用来区分不同厂商的代码。假设A厂商的axxxx头文件定义了一个方法叫"wanda"。厂商B的bxxx头文件也定义了一个方法叫"wanda"那编译器就不知道你用的是哪个版本的"wanda"方法。

所以使用名称空间来区分，例如：A::wanda就是调用A厂商的方法，B::wanda就是调用B厂商的方法。

std是指标准命名空间，类、函数、变量等都是C++的标准组件，他们都被放在的标准命名空间中。所以如果上文的代码可以改成：

~~~c++
# include <iostream>

int main(){
    std::cout << "Hello BA!!!" << std::endl;
    std::cout << "welcome to c++" << std::endl;
}
~~~

但是这样很繁琐，所以出现了using编译指令:

~~~c++
using namespace std;
using std::cout;
~~~

# 函数原型和函数定义

在C和C++中，如上文说的，使用cout需要导入头文件iostream。这是因为在C++和C中，头文件负责声明的函数原型，函数原型如下：

~~~c++
double sqrt(double);
~~~

函数头在文写过，如下：

~~~c++
double sqrt(double){
  ...
}
~~~

区别就是一个是分号结尾，一个是花括号结尾。

带有具体实现功能的函数称为函数定义，这其实就是java中接口和实现的关系。

函数原型被声明在头文件中，而函数定义存储在库文件中。当编译器进行编译时，会在库文件中搜索你使用的函数，但是具体使用哪个库文件，就看编译器。这里应该也是C++具有可移植性的原因之一。

