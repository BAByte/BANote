[toc]
# 1.mvvm初探
## 先说两句
mvvm肯定是个缩写(这好像是句废话) m是model，v是view ，vm是viewModel，mvvm的框架的结构在下图
![image](https://images2015.cnblogs.com/blog/112316/201606/112316-20160616144255948-1076854192.png)

初次接触可能会比较难理解，我尽量写的详细一点。
## mvvm的概念
(这里我讲的是一些比较简单的问题，那些什么单元测试，解耦的术语我就不写了，你可以自己百度看看,其实是因为可能会看得你一头雾水)

如果用安卓默认的开发模式（mvc）我们会遇到什么问题呢？比如我们的需求是：写一个hallow word程序，但是显示的不是hallow word 而是后台传给你的数据，为了简单，你可能直接写成这样
+ 写一个在activiy布局中加一个textVIew，给个id，然后直接在Activity中找到这个textView，然后发起网络请求，去拿到jason数据，转化为java bean，然后调用textVIew的setText方法把java bean的数据取出来显示。

上面是最简单的实现方法了吧？但是我们一步一步分析一下
+ 从找到activity中的textView，这里只有一个textVIew，要是有很多不同的view呢？是不是要写一堆findViewById？
+ 发起网络请求和处理jason数据也是在Activity中实现的，那activiy的负担会不会太重？
+ 一个setText方法还好，如果很多个view是不是又要set一堆？

简单的说，就是Activity的负担太重了，他不符合单一职责的原则，这里还没有监听事件呢！！如果有呢？是不是又一堆代码要加到activity中？

再有，这里的activity充当的是一个怎样的角色？是不是view和model沟通的桥梁？他负责了从获取数据，处理数据，处理数据显示的所有流程！而view从头到位就只负责显示，model也只负责存数据，哇！那activity当然不服啊！activity真的要追宗溯源的话其实也是一个window，凭什么view干这么少的活，activity要干这么多？


当然可以用其他模式来解决，但是我就是要用mvvm解决这些个问题。

那我们能不能给出一个类，来帮activity分担一下？在mvvm上，这个专门用来处理业务逻辑的类叫做viewModel，这个类是专门用来处理数据的(业务逻辑)，需要注意的是，这个类是不去做任何的view操作的，他只是去操作数据。那activity是不是就减轻了重担？

但是问题又来了，那数据变了，view显示却没有变啊，那怎么办？不急，谷歌给我们提供了一个工具，专门用来绑定model和view，叫做dataBinding，他最大的功能就是，将数据模型和view绑定，这样只要数据模型一旦发生了改变，那么view的显示也是会改变。咦！你认真想想，这就解决了activity里要写一堆findViewById方法，也不用写一堆set方法了！！！这个工具很牛逼，后面会讲到，这里只要知道他的功能就好。

那问题又来了，根据数据发生改变的view处理好了，但是，view的点击事件呢？当然是view自己处理啊，点击事件其实主要的目的有下面这种情形
+ 点击按钮后某些数据发生改变，这个其实也是属于数据的操作，我们可以用dataBinding设置监听的，然后在viewModel对数据进行处理
+ 点击按钮后按钮隐藏，变色等等等等，那传统的方法就是在Activity设置监听，然后view做出改变，但是我们打死都不愿意写这个findViewByid怎么办？其实这个隐藏，颜色，都是属性，他其实也是数据，那我们可以在viewModel中加这个属性，点击的时候改变这个属性，那view还是没有改变啊，不急，依旧是强大的dataBinding，但是你需要注意的是，这个时候不是将View和model绑定了，这个属性是我们自定义的，不属于原有的model，所以我们可以在viewModel加一个属性，然后意一样改数据就可以实现view的状态变化

咦！那就有意思了，viewModel里面确实是不做任何的view操作，而且他针对的就是数据，他只操作数据，这样我们写ViewModel的时候可以专注处理业务逻辑，根本不用管view。

我们来看看activity减轻了什么负担，但是增加了什么任务。
+ activty不用去处理view和model的关系，现在activity可以说是直接和model断绝了关系，但是activity要去更新view(这个是必须的，毕竟考虑到ui线程，而且activity是一个个window，要他管理view也是无可厚非)
+ 那增加了什么呢？就是将model和viewmodel进行注入，监听viewModel的属性变化

那view和viewModel怎么绑定？dataBinding啊！！这个只要你操作一下即可。后面会讲。

所以说一个View应该对应着一个viewModel，而且很有意思的地方是，当他们需要的数据类型和操作相同时，可以复用一个ViewModel，再有带来的缺点就是，在以前你是可以用100行代码搞定的东西，现在你需要些200行，说是苦逼了一点，但是为了项目有一个很好的结构，也是值得的。


## mvvm中的角色
### view
做自己，显示数据就好,（滑动隐藏一部分，比如bottomBar当然也是view的事）
### model（bean）
做自己，存数据就好
### dataBinding
将view和model绑定，当model的数据变化时自动刷新view的显示
### viewModel
处理数据，只处理数据！！！不持有view的引用！！！
### activity
管理上面几个东西，监听viewModel的一些属性然后改变view的某些状态
## 总结
这个开发框架其实我个人一开始是没懂的，但其实是人之常情，为啥这样说呢？我相信任何一个程序员都会有这样的想法：哇这个几行代码就写好这个功能了，牛逼！！！wc，这个要写这么多代码才能实现这个功能，我去看看有没有简单的方法。这其实是程序员的通病吧。这个mvvm框架其实也是属于代码多的，所以记得一定不要滥用，不是说写一个很简单的东西你也要去用这个mvvm框架！

这个框架的优点就是：你可以专注的在viewModel里面处理业务逻辑，view不用管，这就很有意思了，那其实可以一个人写view，一个人写业务逻辑，当合并的时候只需要在Activity处理view的更新就好。现在我越来越喜欢这个mvvm了