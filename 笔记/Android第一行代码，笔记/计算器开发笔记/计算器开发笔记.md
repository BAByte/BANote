[TOC]

# 计算器开发笔记

---

### 写在前面

+ 这个只是分析了我这个计算器的代码结构，具体源码可以上我的主页

### 计算功能的实现

+ 使用java的arity函数库作为计算核心

+ 下载arity的jar包，放到lib目录下，在build.gradle文件再Sync now一下

+ 使用Symbols对象进行计算

  ~~~java
  Symbols s = new Symbols();
  double results = s.eval("这里传入表达式");
  ~~~

  ​

### 计算器具体逻辑

看看计算的具体的简单过程，我们给计算器输入一条表达式，按下等于键后，计算器就会进行表达式的计算，然后将计算的结果告诉显示器，显示器将（我们这里用TextView显示）结果和过程显示出来

## 分析

---



### 类结构，图片估计你已经知道在哪里了

![D%U49Z9HSJT}%IB7QGA2ZQ](E:\Android第一行代码，笔记\计算器开发笔记\D%U49Z9HSJT}%IB]7QGA2ZQ.png)

首先要清楚，横屏（科学）计算器和竖屏（普通）计算器的显示效果是不一样的，但是底层对表达式的操作都是一样的，所以我们才将上面4个分出来，好处在于，任何一种计算器都底层都要对表达式进行操作，添加，删除，等于，这样就可以将计算器中的一些代码实现了复用，而且哪一个步骤出了问题，一查便知，只需要修改相应的部分即可。

---

### 拆解计算器各组成分

先看上图中calculator_util包中的类

1. 计算器大脑

   - Calculator：一个接口，所有计算器的抽象，包含的计算器必须有的方法，给按键用来通知计算器的电话，为什么要有这个接口呢，因为我把竖屏的计算器和横屏的计算器分开了，这是两种不同的计算器，但是Activity调用的方法确实一样的，所以就把他必须有的东西抽象出来。其实就是接口的用法


   - CalculatorOfPort：竖屏计算器大脑，实现了上面的接口
   - CalculatorOfLand：横屏，实现了上面的接口

2. 计算器大脑的手下

- 向表达式添加数据的类:AddNumer
- 向表达式添加运算符的类:AddSigner
- 删除表达式中的内容的类:Deleter
- 计算表达式结果的类:Equaler
- CalculatorStatusListener：手下联系事务部的电话，有什么用呢？往表达式里面添加内容时要符合一定的规矩，比如不能连续输入两个运算符。事务部就专门记录输入的情况，这样就可以用来判断符不符合规矩了，其实就是用来管理计算中各种各样的情况

1. 计算器的显示器
   + Activity中的TextView
   + TextViewListener：显示器的回调接口。用来给计算器通知显示器显示计算过程和结果的电话
2. 计算器中的按键
   + Activity中的各个按钮监听

---

### 各组成成分的联系，我们这里只分析竖屏计算器

Acitivity中有按钮，显示器（TextView），持有联系计算大脑的电话（Calculator接口）

计算器大脑，持有联系显示器的电话（TextViewListener），手下，表达式

计算器大脑的手下，持有表达式，事务部的联系电话（CalculatorStatusListener）

---

### 计算时各组成成分的工作过程

按下数字1，按钮使用电话（Calculator接口）联系计算器大脑（CalculatorOfPort）：喂？大脑吗，我是1啊！！！对对对是我，我被加入表达式了！你帮我处理一下。

计算器大脑（CalculatorOfPort）接到电话，哦！原来是你这单身狗啊，行！没问题，计算器大脑告诉手下（AddNumer），你去把数字1加到表达式

手下（AddNumer）：好的老大！！我这就去

手下（AddNumer）添加完后，打通事务部的电话（CalculatorStatusListener）将一些表达式的状态反馈给事务部（比如当前输入的是数字）喂！事务部的小王吗？？我刚刚往表达式添加了一个数字，现在表达式的情况如下。。。。。。

事务部接到电话。okok我知道了

然后手下告诉计算器大脑：老大，我搞定了！

计算器大脑打通Activity中显示器（TextView）的电话（TextViewListener），显示器啊，刚刚数字1已经加入到表达式中了，你处理一下

显示器接完电话后，将数字1显示出来

这就是工作的流程

### 源代码

https://github.com/ljh998/Calculator